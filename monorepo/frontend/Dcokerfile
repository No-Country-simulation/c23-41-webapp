FROM node:18 AS build

WORKDIR /app


COPY package*.json ./

RUN npm install


COPY . .


RUN npm run build:ssr

FROM node:18-alpine

WORKDIR /app

COPY --from=build /app/dist /app/dist
COPY --from=build /app/package*.json /app/


RUN npm ci --only=production

EXPOSE 4000


CMD ["node", "dist/server/main.js"]
