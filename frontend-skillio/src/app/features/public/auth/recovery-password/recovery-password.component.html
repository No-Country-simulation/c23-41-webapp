<div class="flex justify-center items-center min-h-screen px-4 py-8">
  <div class="w-full max-w-md bg-white rounded-xl shadow-lg p-6 md:p-8">
    <!-- Header -->
    <div class="mb-8">
      <h2 class="text-2xl font-bold text-gray-900 text-center mb-2">Reset Password</h2>
      <p class="text-gray-600 text-center text-sm">Choose your preferred recovery method</p>
    </div>

    <!-- Tabs -->
    <p-tabView>
      <!-- Email Tab -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="flex items-center gap-2">
            <lucide-icon [img]="mail" class="h-4 w-4 text-gray-700" />
            <span class="text-gray-700">Email</span>
          </div>
        </ng-template>

        <!-- Reusable Form Template -->
        <ng-template #recoveryFormTemplate let-method>
          <form [formGroup]="recoveryForm" class="mt-6 space-y-6">
            <!-- Email Input -->
            @if (method === 'email') {
              <div class="relative">
                <span class="p-float-label">
                  <input
                    id="email"
                    type="email"
                    pInputText
                    formControlName="email"
                    class="w-full border border-gray-300 rounded-lg p-3 transition-colors duration-200 focus:border-emerald-500 focus:ring focus:ring-emerald-200 focus:ring-opacity-50"
                  />
                  <label for="email" class="text-gray-500">Institutional Email</label>
                </span>
                @if (recoveryForm.get('email')?.invalid && recoveryForm.get('email')?.touched) {
                  <small class="absolute -bottom-5 left-0 text-red-500 text-xs">
                    Please enter a valid email address
                  </small>
                }
              </div>
            }

            <!-- Phone Input -->
            @if (method === 'phone') {
              <div class="relative">
                <span class="p-float-label">
                  <input
                    id="phone"
                    type="text"
                    pInputText
                    formControlName="phone"
                    class="w-full border border-gray-300 rounded-lg p-3 transition-colors duration-200 focus:border-emerald-500 focus:ring focus:ring-emerald-200 focus:ring-opacity-50"
                  />
                  <label for="phone" class="text-gray-500">Phone Number</label>
                </span>
                @if (recoveryForm.get('phone')?.invalid && recoveryForm.get('phone')?.touched) {
                  <small class="absolute -bottom-5 left-0 text-red-500 text-xs">
                    Please enter a valid phone number
                  </small>
                }
              </div>
            }

            <!-- Unified Button -->
            <button
              pButton
              type="submit"
              [loading]="loading()"
              [disabled]="recoveryForm.invalid || loading()"
              class="w-full flex justify-center items-center bg-secondary text-black rounded-lg py-3 px-4 transition-all duration-200 disabled:opacity-70 disabled:cursor-not-allowed"
            >
              <span class="inline-flex items-center justify-center w-full">
                {{ loading() ? 'Sending...' : method === 'email' ? 'Send Recovery Email' : 'Send Recovery Code' }}
              </span>
            </button>
          </form>
        </ng-template>

        <!-- Render Email Form -->
        <ng-container *ngTemplateOutlet="recoveryFormTemplate; context: { $implicit: 'email' }"></ng-container>
      </p-tabPanel>

      <!-- Phone Tab -->
      <p-tabPanel>
        <ng-template pTemplate="header">
          <div class="flex items-center gap-2">
            <lucide-icon [img]="phone" class="h-4 w-4 text-gray-700" />
            <span class="text-gray-700">Phone</span>
          </div>
        </ng-template>

        <!-- Render Phone Form -->
        <ng-container *ngTemplateOutlet="recoveryFormTemplate; context: { $implicit: 'phone' }"></ng-container>
      </p-tabPanel>
    </p-tabView>

    <!-- Footer -->
    <div class="mt-8 text-center flex flex-col text-sm">
      <span class="text-gray-600">Remember your password?</span>
      <a
        routerLink="/login"
        class="text-emerald-600 hover:text-emerald-500 ml-1 font-medium transition-colors duration-200 cursor-pointer"
      >
        Back to login
      </a>
    </div>
  </div>
</div>